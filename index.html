<!DOCTYPE html>
<html>
<head>
    <title>Real Time Communication - Client</title>
    <style type="text/css">
        body, input {
            font-family: Tahoma;
            font-size: 20px;
        }

        #div1 {
            background-color: #00cccc;
            margin: 10px;
            padding: 10px;
            height: 30px;
        }

        #div2 {
            background-color: #ccffff;
            margin: 10px;
            padding: 10px;
            height: 100px;
            overflow: auto;
        }

        #div3 {
            background-color: #99ffcc;
            margin: 10px;
            padding: 10px;
            height: 30px;
        }
    </style>
</head>
<body>

    <h1>Real Time Communication - Client</h1>

    <div id="div1">
        Userid: <input type="text" id="txtuserid" value="" autofocus="autofocus">
        Username: <input type="text" id="txtusername" value="" autofocus="autofocus">
        <input type="submit" value="Join" id="btnjoin" onclick="joinComm(txtusername.value, txtuserid.value)">
    </div>
    <div id="usersList">
        <table id="userTable" border='1'>
            <tr>
                <th>Users</th>
            </tr>
        </table>
    </div>
    <div id="div2">
    </div>



    <!-- userlist bind -->
    <div class="span3">
        <!-- In Call Actions -->
        <div class="well actions">
            <div class="status" data-bind="text: CallStatus"></div>
            <button class="btn btn-danger hangup">Hang Up</button>
        </div>
        <!-- User List -->
        <div class="well user-list">
            <ul class="nav nav-list">
                <li class="nav-header">Online Users <small data-bind="text: Users().length"></small></li>
                <!-- ko foreach: Users -->
                <li class="user" data-bind="attr: { 'data-cid': ConnectionId, 'title': Username }">
                    <a href="#">
                        <!-- only using an a here for bootstrap styling -->
                        <div class="username" data-bind="text: Username"></div>
                        <div class="helper" data-bind="css: $parent.getUserStatus($data)"></div>
                    </a>
                </li>
                <!-- /ko -->
            </ul>
        </div>
    </div>
    <!-- userlist bind  -->




    <div id="div3">
        <form id="form1">
            Message: <input type="text" id="txtmessage">
            <input type="submit" value="Send" disabled="disabled" id="btnsubmit">
        </form>
    </div>

    <!--<script src="/node_modules/socket.io-client/socket.io.js"></script>-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="node_modules/socket.io/node_modules/socket.io-client/dist/socket.io.js"></script>
   
    <script>


        function joinComm(userName, userId) {

            var server = io.connect("ws://localhost:7049");
            server.on("connect", fun1);

            function fun1() {
                console.log("check");
                document.getElementById("div2").innerHTML += "<p>Connected to server</p>";
                document.getElementById("btnsubmit").removeAttribute("disabled");
                var userData = { userName: userName, userId: userId, orgId: 1, centerId: 1, socketId: "", roomId: "" }
                server.emit("addUser", userData);
            }



            server.on("receiveUsersList", updateUsersList);
            function updateUsersList(usersList) {
                console.log("check2");
                var trHTML = '';
                $('#userTable').empty();
                $.each(usersList, function (i, item) {
                    trHTML += '<tr><td>' + item.value.userName + '</td></tr>';
                });

                $('#userTable').append(trHTML);
            };

            document.getElementById("form1").addEventListener("submit", fun2);
            function fun2(event) {
                var s = document.getElementById("txtusername").value + ": " + document.getElementById("txtmessage").value;
                server.emit("clientMessage", s);
                event.preventDefault();
            }

            server.on("serverMessage", fun3);
            function fun3(data) {
                document.getElementById("div2").innerHTML += data + "<br>";
                document.getElementById("div2").scrollTop(0, document.getElementById("div2").scrollHeight);
            }

            //initiate a call by client
            function initiateCall() {
                server.emit("initiateCall", toClientId);
            }
        };
    </script>

</body>
</html>
